<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LTNG Task Manager</title>
    <!-- Import the minified framework -->
    <script src="../../dist/ltng-framework.min.js"></script>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .task-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 20px;
        }
        .task-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .task-actions {
            display: flex;
            gap: 10px;
        }
        .completed {
            text-decoration: line-through;
            color: #888;
        }
    </style>
</head>
<body>
    <script>
        // Initialize Store
        // We use createFormStore because the Form component requires specific methods (GetFormState, etc.)
        const store = createFormStore({
            tasks: [
                { id: 1, title: 'Check out LTNG Framework', completed: true },
                { id: 2, title: 'Build a cool app', completed: false }
            ],
            form: {} // For Form component
        });

        // Actions
        const addTask = (title) => {
            const state = store.getState();
            const newTask = {
                id: Date.now(),
                title,
                completed: false
            };
            store.setState({ tasks: [...state.tasks, newTask] });
            Toast.success('Task added successfully!');
        };

        const toggleTask = (id) => {
            const state = store.getState();
            const updatedTasks = state.tasks.map(t => 
                t.id === id ? { ...t, completed: !t.completed } : t
            );
            store.setState({ tasks: updatedTasks });
        };

        const deleteTask = (id) => {
            // Confirm with Modal
            store.setState({ modalOpen: true, taskToDelete: id });
        };
        
        const App = () => {
            const container = Div({ class: 'app-container', style: 'max-width: 600px; margin: 0 auto;' });

            const render = (state) => {
                container.innerHTML = '';

                // Header
                container.appendChild(Typography.H1({ style: 'text-align: center; color: #333;' }, 'LTNG Task Manager'));

                // Add Task Form
                const form = Form({
                    store,
                    onSubmit: (values) => {
                        // The Form component passes { ...event, formObject }
                        // We need the value from the field.
                        // The fieldKey is 'taskTitle'.
                        // values.formObject['taskTitle'].value
                        const title = values.formObject['taskTitle'].value;
                        if (title) {
                            addTask(title);
                            // Reset form field
                            store.SetFormItemState({ id: 'taskTitle', value: '', required: true }); 
                        }
                    }
                },
                    Form.Field({
                        store,
                        fieldKey: 'taskTitle',
                        label: 'New Task Title',
                        isRequired: true
                    }),
                    Form.PrimaryButton({ store, style: 'width: 100%; margin-top: 10px;' }, 'Add Task')
                );
                
                container.appendChild(Card({ style: 'padding: 20px; margin-bottom: 20px;' }, form));

                // Task List
                const list = Div({ class: 'task-list' });
                if (state.tasks.length === 0) {
                    list.appendChild(Typography.Paragraph({ style: 'text-align: center; color: #666;' }, 'No tasks yet. Add one above!'));
                } else {
                    state.tasks.forEach(task => {
                        const taskCard = Card({ class: 'task-item', style: 'padding: 15px;' },
                            Div({ 
                                class: task.completed ? 'completed' : '',
                                style: 'flex-grow: 1; cursor: pointer;',
                                onClick: () => toggleTask(task.id)
                            }, task.title),
                            Div({ class: 'task-actions' },
                                Button.Secondary({ 
                                    onClick: () => toggleTask(task.id),
                                    style: 'padding: 5px 10px; font-size: 0.8em;'
                                }, task.completed ? 'Undo' : 'Done'),
                                Button({ 
                                    style: 'padding: 5px 10px; font-size: 0.8em; background-color: #ff4444; color: white; border: none;',
                                    onClick: () => deleteTask(task.id)
                                }, 'Delete')
                            )
                        );
                        list.appendChild(taskCard);
                    });
                }
                container.appendChild(list);

                // Modal
                if (state.modalOpen) {
                    const modal = Modal({
                        isOpen: true,
                        onClose: () => store.setState({ modalOpen: false, taskToDelete: null })
                    },
                        Typography.H3({}, 'Confirm Delete'),
                        Typography.Paragraph({}, 'Are you sure you want to delete this task? This action cannot be undone.'),
                        Div({ style: 'display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px;' },
                            Button.Secondary({ onClick: () => store.setState({ modalOpen: false, taskToDelete: null }) }, 'Cancel'),
                            Button.Primary({ 
                                onClick: () => {
                                    const s = store.getState();
                                    const filtered = s.tasks.filter(t => t.id !== s.taskToDelete);
                                    store.setState({ tasks: filtered, modalOpen: false, taskToDelete: null });
                                    Toast.failure('Task deleted permanently.');
                                }
                            }, 'Delete')
                        )
                    );
                    if (modal) container.appendChild(modal);
                }

                // Toast Container
                container.appendChild(Toast.Container({ store: window.toastStore }));
            };

            // Initial Render
            render(store.getState());

            // Subscribe
            store.subscribe(render);

            return container;
        };

        // Mount App
        Body.render(App());


    </script>
</body>
</html>
